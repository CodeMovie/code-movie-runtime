var S=Object.defineProperty;var w=s=>{throw TypeError(s)};var A=(s,r,t)=>r in s?S(s,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[r]=t;var b=(s,r,t)=>A(s,typeof r!="symbol"?r+"":r,t),y=(s,r,t)=>r.has(s)||w("Cannot "+t);var n=(s,r,t)=>(y(s,r,"read from private field"),t?t.call(s):r.get(s)),l=(s,r,t)=>r.has(s)?w("Cannot add the same private member more than once"):r instanceof WeakSet?r.add(s):r.set(s,t),o=(s,r,t,e)=>(y(s,r,"write to private field"),e?e.call(s,t):r.set(s,t),t),g=(s,r,t)=>(y(s,r,"access private method"),t);function _(s){let r=Math.round(Number(s));return Number.isFinite(r)&&!Number.isNaN(r)?r:0}function k(s){return Math.abs(_(s))}function C(s){return s?String(s).split(/\s+/).map(k).sort((r,t)=>r-t):[]}var d,h,a,i,c,f,x,v=class v extends HTMLElement{constructor(){super();l(this,f);b(this,"_shadow",this.attachShadow({mode:"open"}));l(this,d,new CSSStyleSheet);l(this,h,this.attachInternals());l(this,a,[]);l(this,i,0);l(this,c,null);b(this,"_handleClick",t=>{if(t.type==="click"){for(let e of t.composedPath())if(e instanceof HTMLElement){if(e.getAttribute("data-command")==="next"){this.next();return}if(e.getAttribute("data-command")==="prev"){this.prev();return}}}});let t=v._template();this._shadow.append(...t),this._shadow.addEventListener("click",this._handleClick);let e=this._shadow.querySelector("slot:not([name])");if(!e)throw new Error("Template does not contain a default slot");e.addEventListener("slotchange",()=>this._goToCurrent()),this._shadow.adoptedStyleSheets.push(n(this,d))}static _template(){let t=document.createElement("div");return t.innerHTML=`<div part="wrapper">
  <slot></slot>
  <div part="controls-wrapper">
    <slot name="controls">
      <div part="controls">
        <button part="controls-prevBtn" data-command="prev">
          <span>&lt;</span>
        </button>
        <button part="controls-nextBtn" data-command="next">
          <span>&gt;</span>
        </button>
      </div>
    </slot>
  </div>
  <div part="aux-wrapper">
    <slot name="aux"></slot>
  </div>
</div>
<style>
[part="wrapper"] { display: grid; }
:host(:not([controls])) slot[name="controls"] { display: none }
[part="controls"] { position: relative; z-index: 1337; }
</style>`,Array.from(t.children)}static get observedAttributes(){return["keyframes","current"]}attributeChangedCallback(t,e,u){e!==u&&(t==="keyframes"?(o(this,a,C(u)),g(this,f,x).call(this),this._goToCurrent()):t==="current"&&(o(this,i,this._toKeyframeIdx(u)),this._goToCurrent()))}get controls(){return this.hasAttribute("controls")}set controls(t){t?this.setAttribute("controls","controls"):this.removeAttribute("controls")}get keyframes(){return n(this,a)}set keyframes(t){Array.isArray(t)?(t=Array.from(new Set(t.map(k).sort((e,u)=>e-u))),this.setAttribute("keyframes",t.join(" ")),o(this,a,t)):(this.removeAttribute("keyframes"),o(this,a,[])),g(this,f,x).call(this),this._goToCurrent()}_toKeyframeIdx(t){let e=_(t);return e<0&&(e=Math.abs(e)-1),e>this.maxFrame&&(e=this.maxFrame),n(this,a).indexOf(e)}get current(){return n(this,a)[n(this,i)]||0}set current(t){let e=this._toKeyframeIdx(t);e!==-1?(o(this,i,e),this.setAttribute("current",String(n(this,a)[e]))):(o(this,i,0),this.setAttribute("current","0"))}get nextCurrent(){return n(this,c)&&n(this,a)[n(this,i)]||null}get maxFrame(){return Math.max(...this.keyframes)}_goToCurrent(){let t=n(this,i);t in n(this,a)||(n(this,a).length>=1&&t<0?t=n(this,a).length-1:t=0),o(this,c,t);let e=this.dispatchEvent(new Event("cm-beforeframechange",{bubbles:!0,cancelable:!0}));return o(this,c,null),e?(this._setClassesAndStates(n(this,a)[t]),t!==n(this,i)&&o(this,i,t),this.dispatchEvent(new Event("cm-afterframechange",{bubbles:!0})),!0):!1}_setClassesAndStates(t){for(let m of n(this,h).states)/^frame[0-9]+$/.test(m)&&n(this,h).states.delete(m);n(this,h).states.add(`frame${t}`);let u=this._shadow.querySelector("slot:not([name])")?.assignedElements()[0];if(u){for(let m of u.classList)/^frame[0-9]+$/.test(m)&&u.classList.remove(m);u.classList.add(`frame${t}`)}}next(){let t=n(this,i);return o(this,i,n(this,i)+1),this._goToCurrent()?this.current:(o(this,i,t),t)}prev(){let t=n(this,i);return o(this,i,n(this,i)-1),this._goToCurrent()?this.current:(o(this,i,t),t)}go(t){let e=n(this,i);return o(this,i,this._toKeyframeIdx(t)),this._goToCurrent()?this.current:(o(this,i,e),e)}};d=new WeakMap,h=new WeakMap,a=new WeakMap,i=new WeakMap,c=new WeakMap,f=new WeakSet,x=function(){let t='slot[name="aux"]::slotted(*){ display: none }';for(let e of n(this,a))t+=`:host(:state(frame${e})) slot[name="aux"]::slotted(.frame${e}) { display: block; }`;n(this,d).replaceSync(t)};var p=v;window.customElements.define("code-movie-runtime",p);export{p as CodeMovieRuntime};
