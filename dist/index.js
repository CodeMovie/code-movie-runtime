var S=Object.defineProperty;var w=r=>{throw TypeError(r)};var A=(r,n,t)=>n in r?S(r,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[n]=t;var b=(r,n,t)=>A(r,typeof n!="symbol"?n+"":n,t),y=(r,n,t)=>n.has(r)||w("Cannot "+t);var s=(r,n,t)=>(y(r,n,"read from private field"),t?t.call(r):n.get(r)),l=(r,n,t)=>n.has(r)?w("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(r):n.set(r,t),a=(r,n,t,e)=>(y(r,n,"write to private field"),e?e.call(r,t):n.set(r,t),t),g=(r,n,t)=>(y(r,n,"access private method"),t);function k(r){let n=Math.round(Number(r));return Number.isFinite(n)&&!Number.isNaN(n)?n:0}function _(r){return Math.abs(k(r))}function C(r){return r?String(r).split(/\s+/).map(_).sort((n,t)=>n-t):[]}var d,h,o,i,c,f,v,x=class x extends HTMLElement{constructor(){super();l(this,f);b(this,"_shadow",this.attachShadow({mode:"open"}));l(this,d,new CSSStyleSheet);l(this,h,this.attachInternals());l(this,o,[]);l(this,i,0);l(this,c,null);b(this,"_handleClick",t=>{if(t.type==="click"){for(let e of t.composedPath())if(e instanceof HTMLElement){if(e.getAttribute("data-command")==="next"){this.next();return}if(e.getAttribute("data-command")==="prev"){this.prev();return}}}});let t=x._template();this._shadow.append(...t),this._shadow.addEventListener("click",this._handleClick);let e=this._shadow.querySelector("slot:not([name])");if(!e)throw new Error("Template does not contain a default slot");e.addEventListener("slotchange",()=>this._goToCurrent()),this._shadow.adoptedStyleSheets.push(s(this,d))}static _template(){let t=document.createElement("div");return t.innerHTML=`<div part="wrapper">
  <slot></slot>
  <div part="controls-wrapper">
    <slot name="controls">
      <div part="controls">
        <button part="controls-prevBtn" data-command="prev">
          <span>&lt;</span>
        </button>
        <button part="controls-nextBtn" data-command="next">
          <span>&gt;</span>
        </button>
      </div>
    </slot>
  </div>
  <div part="aux-wrapper">
    <slot name="aux"></slot>
  </div>
</div>
<style>
[part="wrapper"] { display: grid; }
:host(:not([controls])) slot[name="controls"] { display: none }
[part="controls"] { position: relative; z-index: 1337; }
</style>`,Array.from(t.children)}static with(t){let e=new this;return e.keyframes=Array.from(Array.from({length:t}).keys()),e}static get observedAttributes(){return["keyframes","current"]}attributeChangedCallback(t,e,u){e!==u&&(t==="keyframes"?(a(this,o,C(u)),g(this,f,v).call(this),this._goToCurrent()):t==="current"&&(a(this,i,this._toKeyframeIdx(u)),this._goToCurrent()))}get controls(){return this.hasAttribute("controls")}set controls(t){t?this.setAttribute("controls","controls"):this.removeAttribute("controls")}get keyframes(){return s(this,o)}set keyframes(t){Array.isArray(t)?(t=Array.from(new Set(t.map(_).sort((e,u)=>e-u))),this.setAttribute("keyframes",t.join(" ")),a(this,o,t)):(this.removeAttribute("keyframes"),a(this,o,[])),g(this,f,v).call(this),this._goToCurrent()}_toKeyframeIdx(t){let e=k(t);return e<0&&(e=Math.abs(e)-1),e>this.maxFrame&&(e=this.maxFrame),s(this,o).indexOf(e)}get current(){return s(this,o)[s(this,i)]||0}set current(t){let e=this._toKeyframeIdx(t);e!==-1?(a(this,i,e),this.setAttribute("current",String(s(this,o)[e]))):(a(this,i,0),this.setAttribute("current","0"))}get nextCurrent(){return s(this,c)&&s(this,o)[s(this,i)]||null}get maxFrame(){return Math.max(...this.keyframes)}_goToCurrent(){let t=s(this,i);t in s(this,o)||(s(this,o).length>=1&&t<0?t=s(this,o).length-1:t=0),a(this,c,t);let e=this.dispatchEvent(new Event("cm-beforeframechange",{bubbles:!0,cancelable:!0}));return a(this,c,null),e?(this._setClassesAndStates(s(this,o)[t]),t!==s(this,i)&&a(this,i,t),this.dispatchEvent(new Event("cm-afterframechange",{bubbles:!0})),!0):!1}_setClassesAndStates(t){for(let m of s(this,h).states)/^frame[0-9]+$/.test(m)&&s(this,h).states.delete(m);s(this,h).states.add(`frame${t}`),s(this,h).states.add("hasNext"),s(this,h).states.add("hasPrev"),t===0&&s(this,h).states.delete("hasPrev"),t===s(this,o).at(-1)&&s(this,h).states.delete("hasNext");let u=this._shadow.querySelector("slot:not([name])")?.assignedElements()[0];if(u){for(let m of u.classList)/^frame[0-9]+$/.test(m)&&u.classList.remove(m);u.classList.add(`frame${t}`)}}next(){let t=s(this,i);return a(this,i,s(this,i)+1),this._goToCurrent()?this.current:(a(this,i,t),t)}prev(){let t=s(this,i);return a(this,i,s(this,i)-1),this._goToCurrent()?this.current:(a(this,i,t),t)}go(t){let e=s(this,i);return a(this,i,this._toKeyframeIdx(t)),this._goToCurrent()?this.current:(a(this,i,e),e)}};d=new WeakMap,h=new WeakMap,o=new WeakMap,i=new WeakMap,c=new WeakMap,f=new WeakSet,v=function(){let t='slot[name="aux"]::slotted(*){ display: none }';for(let e of s(this,o))t+=`:host(:state(frame${e})) slot[name="aux"]::slotted(.frame${e}) { display: block; }`;s(this,d).replaceSync(t)};var p=x;window.customElements.define("code-movie-runtime",p);export{p as CodeMovieRuntime};
